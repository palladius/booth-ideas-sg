---
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Pill Calendar</title>
  </head>
  <body>
    <main>
      <h1>Pill Calendar</h1>

      <div class="container">
        <div class="calendar">
          <h2>Calendar</h2>
          <div class="calendar-grid">
            <!-- Calendar days will be generated here -->
          </div>
        </div>

        <div class="pills-form">
          <h2>Add New Pill</h2>
          <form>
            <label for="pill-name">Pill Name:</label>
            <input type="text" id="pill-name" name="pill-name" required />

            <label for="frequency">Frequency:</label>
            <select id="frequency" name="frequency">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>

            <div id="weekly-options">
              <label for="weekly-day">Day of the week:</label>
              <select id="weekly-day" name="weekly-day">
                <option value="1">Monday</option>
                <option value="2">Tuesday</option>
                <option value="3">Wednesday</option>
                <option value="4">Thursday</option>
                <option value="5">Friday</option>
                <option value="6">Saturday</option>
                <option value="7">Sunday</option>
              </select>
            </div>

            <div id="monthly-options">
              <label for="monthly-day">Day of the month:</label>
              <input type="number" id="monthly-day" name="monthly-day" min="1" max="31" />
            </div>

            <button type="submit">Add Pill</button>
          </form>
        </div>
      </div>
    </main>

    <style>
      body {
        font-family: sans-serif;
      }

      main {
        max-width: 800px;
        margin: 0 auto;
      }

      .container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 0.5rem;
      }

      .calendar-grid > div {
        border: 1px solid #ccc;
        padding: 1rem;
        text-align: center;
      }

      .pills-form form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
    </style>
  <script>
      const frequencySelect = document.getElementById('frequency');
      const weeklyOptions = document.getElementById('weekly-options');
      const monthlyOptions = document.getElementById('monthly-options');
      const pillsForm = document.querySelector('.pills-form form');
      const calendarGrid = document.querySelector('.calendar-grid');

      function generateCalendar() {
        calendarGrid.innerHTML = '';
        const today = new Date();
        const month = today.getMonth();
        const year = today.getFullYear();

        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const firstDayOfMonth = new Date(year, month, 1).getDay();

        for (let i = 0; i < firstDayOfMonth; i++) {
          const emptyDay = document.createElement('div');
          calendarGrid.appendChild(emptyDay);
        }

        for (let i = 1; i <= daysInMonth; i++) {
          const day = document.createElement('div');
          day.innerText = i;
          calendarGrid.appendChild(day);
        }
      }

      function displayPills() {
        const pills = JSON.parse(localStorage.getItem('pills')) || [];
        const today = new Date();
        const month = today.getMonth();
        const year = today.getFullYear();

        const days = calendarGrid.querySelectorAll('div');
        days.forEach((day) => {
          const dayNumber = parseInt(day.innerText);
          if (dayNumber) {
            const dayPills = day.querySelectorAll('p');
            dayPills.forEach((p) => p.remove());

            pills.forEach((pill) => {
              if (pill.frequency === 'daily') {
                const pillElement = document.createElement('p');
                pillElement.innerText = pill.name;
                day.appendChild(pillElement);
              } else if (pill.frequency === 'weekly') {
                const dayOfWeek = new Date(year, month, dayNumber).getDay();
                if (dayOfWeek === parseInt(pill.weeklyDay)) {
                  const pillElement = document.createElement('p');
                  pillElement.innerText = pill.name;
                  day.appendChild(pillElement);
                }
              } else if (pill.frequency === 'monthly') {
                if (dayNumber === parseInt(pill.monthlyDay)) {
                  const pillElement = document.createElement('p');
                  pillElement.innerText = pill.name;
                  day.appendChild(pillElement);
                }
              }
            });
          }
        });
      }

      frequencySelect.addEventListener('change', () => {
        if (frequencySelect.value === 'weekly') {
          weeklyOptions.style.display = 'block';
          monthlyOptions.style.display = 'none';
        } else if (frequencySelect.value === 'monthly') {
          weeklyOptions.style.display = 'none';
          monthlyOptions.style.display = 'block';
        } else {
          weeklyOptions.style.display = 'none';
          monthlyOptions.style.display = 'none';
        }
      });

      pillsForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const pillName = document.getElementById('pill-name').value;
        const frequency = document.getElementById('frequency').value;
        const weeklyDay = document.getElementById('weekly-day').value;
        const monthlyDay = document.getElementById('monthly-day').value;

        const pill = {
          name: pillName,
          frequency,
          weeklyDay,
          monthlyDay,
        };

        let pills = JSON.parse(localStorage.getItem('pills')) || [];
        pills.push(pill);
        localStorage.setItem('pills', JSON.stringify(pills));

        pillsForm.reset();
        frequencySelect.dispatchEvent(new Event('change'));
        displayPills();
      });

      generateCalendar();
      displayPills();
    </script>
  </body>
</html>
